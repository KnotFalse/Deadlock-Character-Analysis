# Static Graph Explorer – Implementation Plan

## 1. Goals & Scope
- Deliver a GitHub Pages–hosted, client-only site that lets users explore the Deadlock matchup graph without a live Neo4j instance.
- Provide Bloom-like functionality: pan/zoom graph view, node/relationship styling, search, neighbor expansion, property filtering, and basic analytics (degree, counters, etc.).
- Consume pre-exported static assets (no database connections) so the site remains free to host and easy to cache.

## 2. Data Export Pipeline
1. **Export script (Python)**  
   - Read Neo4j via Bolt, gather nodes/edges with properties and typed labels.  
   - Precompute helpful indexes:  
     - `nodesByLabel`, `relationshipsByType`  
     - Map of character → abilities/mechanics, mechanics → counters, etc.  
   - Run ForceAtlas2 or other layout server-side (graphology layout, or Neo4j Graph Data Science) and store coordinates to avoid heavy client computation.  
   - Output:
     ```json
     {
       "nodes": [{ "id": "Abrams", "label": "Character", "props": {...}, "x": 0.1, "y": -0.4, "size": 5 }],
       "edges": [{ "id": "e1", "source": "Abrams", "target": "Barrier", "type": "CHARACTER_COUNTERS_MECHANIC", "props": {...} }],
       "meta": { "generatedAt": "...", "nodeCount": 32, "edgeCount": 1132 }
     }
     ```
   - Optionally split the dataset (`nodes.json`, `edges.json`, `indexes.json`) if size grows.

2. **Automation**  
   - Add CLI command (`python -m deadlock_graph.cli export-static --out data/static`) that writes JSON under `website/public/`.  
   - Integrate into `scripts/run_sanity.ps1` or new release workflow, ensuring a fresh export lands when matchups change.

## 3. Frontend Stack
| Concern | Choice | Notes |
|---------|--------|-------|
| Build tool | Vite + TypeScript | Fast dev server, easy GitHub Pages deploy. |
| UI framework | React or Svelte (React preferred for ecosystem) | Provide component model for filter/search panels. |
| Graph storage | Graphology | Works with Sigma.js and offers graph algorithms. |
| Visualization | Sigma.js v2 | WebGL rendering, supports styles, hovering, selection, clustering. |
| Search/filter | Fuse.js (fuzzy search) + custom filters | Fuzzy lookup on names, property filters by archetype/mechanic. |
| State management | Zustand/Recoil (React) or Svelte stores | Manage active filters, selected nodes, expanded neighbors. |

## 4. UI / Feature Breakdown
1. **Landing view**  
   - Load JSON, build Graphology instance, render with Sigma.  
   - Display loading spinner (approx 1–2 MB JSON).

2. **Sidebar panels**  
   - **Search** — fuzzy input, select node, center on graph.  
   - **Filters** — toggle by node label, relationship type, properties (e.g., archetype, mechanic categories).  
   - **Details panel** — show selected node’s data, counters, ability list, evidence counts.  
   - **Toolbar** — “Reset view”, “Highlight neighbors”, “Shortest path” (between two selected nodes), “Export selection (CSV/JSON)”.

3. **Graph interactions**  
   - Click node: highlight neighbors, show details.  
   - Edge tooltip: show `reason`, `evidence_count`.  
   - Group styling (color by node label, shape by archetype/mechanic).  
   - Edge thickness or color for STRONG/WEAK/EVEN.  
   - Keyboard shortcuts: `F` to toggle filters, `R` to reset camera.

4. **Analytics overlays (phase 2)**  
   - Precompute centrality scores; allow color/size toggle by metric.  
   - Provide scatterplots or rankings in separate panel.

## 5. Deployment & Hosting
1. **Repo layout**  
   ```
   /website
     /src
     /public
     vite.config.ts
     package.json
   ```
   - `public/graph.json` (generated by export script).

2. **GitHub Pages**  
   - Configure Vite `base` to repo path.  
   - Add GitHub Actions workflow to build (`npm ci && npm run build`) and deploy (`peaceiris/actions-gh-pages`).  
   - Optionally host at `username.github.io/deadlock-graph`.

3. **Offline caching**  
   - Consider simple service worker (Workbox) for offline access, optional.

## 6. Security & Privacy Considerations
- All data is static, so no secrets; ensure `.env` isn’t bundled by Vite (use `public/graph.json`).  
- For future expansions (multi-user plotting), use separate data export script to guard against leakage of internal notes.

## 7. Timeline & Milestones
| Milestone | Description | Estimate |
|-----------|-------------|----------|
| Export pipeline | `deadlock_graph` CLI command + layout computation + JSON artifacts | 1–2 days |
| Frontend scaffold | Vite + React + Sigma + Graphology integration, static render | 2 days |
| UI polish | Search, filters, detail panels, styling, highlight interactions | 3–4 days |
| Analytics & extras | Shortest path, counter summaries, metrics overlays | 2 days |
| Deployment | GitHub Pages action, documentation, sanity exports | 1 day |

## 8. Risks & Mitigations
- **Large JSON size** → compress data, split by category, or lazy-load edges.  
- **Performance on low-end devices** → precompute layout, limit edge rendering (use neighbor-only render, edge bundling).  
- **Data version drift** → enforce export script as part of release pipeline; track `generatedAt` in metadata.  
- **User discovery** → add README/landing page instructions, sample queries (“Show all assassins who counter Movement Slow”).

## 9. Follow-up Enhancements
- Storybook or interactive doc for nodes/relationships.  
- Embeddable components (e.g., iframe with specific subgraph).  
- Integration with Markdown-driven reports (auto-generate matchup tables).

